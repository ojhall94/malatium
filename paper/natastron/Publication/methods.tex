%\documentclass[12pt]{article}
%\setlength{\textwidth}{167mm}
%\setlength{\headsep}{0mm}
%\setlength{\headheight}{0mm}
%\setlength{\textheight}{230mm}
%\setlength{\oddsidemargin}{1.6mm}
%\setlength{\evensidemargin}{1.6mm}
%\setlength{\topmargin}{4.6mm}
%
%\usepackage{chngcntr}
%\usepackage{xspace}
%\usepackage{graphicx}
%\usepackage{amsmath}	% Advanced maths commands
%\usepackage{amssymb}	% Extra maths symbols
%\usepackage[ ]{hyperref}
%\graphicspath{{Images/}}
%%\usepackage[symbol]{footmisc}
%
%
%% Astronomical abbreviations (thanks to Dan Huber)
%\newcommand{\numax}{\mbox{$\nu_{\rm max}$}\xspace}
%\newcommand{\dnu}{\mbox{$\Delta \nu$}\xspace}
%\newcommand{\muHz}{\mbox{$\mu$Hz}\xspace}
%\newcommand{\teff}{\mbox{$T_{\rm eff}$}\xspace}
%\newcommand{\logg}{\mbox{$\log(g)$}\xspace}
%\newcommand{\feh}{\mbox{$\rm{[Fe/H]}$}\xspace}
%\newcommand{\msun}{\mbox{$\mathrm{M}_{\odot}$}\xspace}
%\newcommand{\lsun}{\mbox{$\mathrm{L}_{\odot}$}\xspace}
%\newcommand{\mearth}{\mbox{$\mathrm{M}_{\oplus}$}\xspace}
%\newcommand{\rsun}{\mbox{$\mathrm{R}_{\odot}$}\xspace}
%\newcommand{\kepler}{\emph{Kepler}\xspace}
%\newcommand{\tess}{\emph{TESS}\xspace}
%\newcommand{\ktwo}{K2\xspace}
%\newcommand{\gaia}{\emph{Gaia}\xspace}
%
%\begin{document}

\section*{\underline{Methods}}
%\setcounter{tocdepth}{2}
%\tableofcontents
\section{Asteroseismic Methods}
\subsection{Asteroseismic Data}
For our asteroseismic power spectrum data we used the unweighted power spectra from the KASOC pipeline \cite{handberg+lund2014}. We did not apply any additional treatment to these data. For 16 Cyg A \& B (KIC 12069424 and KIC 12069449) we used the KEPSEISMIC lightcurves \cite{garcia+2011}, which have significantly better signal-to-noise for these two stars.

For our asteroseismic ages, we used the ages obtained by \texttt{BASTA} \cite[BAyesian STellar Algorithm]{silvaaguirre+2015} in the `Kages' and LEGACY catalogues. These ages have been obtained by comparisons of measured oscillation properties to stellar models, accounting for an expanded range of metallicities. \texttt{BASTA} is thoroughly compared to four other seismic modelling techniques in \cite{silvaaguirre+2017}. While uncertainties found through \texttt{BASTA} are typically higher than for other techniques, only \texttt{BASTA} and \texttt{ASTFIT} \cite[Aarhus STellar Evolution Code]{christensen-dalsgaard2008} recover the radius, mass and age of the Sun, when applied to solar data. Although the uncertainties on \texttt{ASTFIT} ages are overall lower, they are not published for the `Kages' sample. In order to maintain an internally consistent stellar age sample, we used age results from \texttt{BASTA} for both the `Kages' and LEGACY samples.

For our stellar masses we used asteroseismic model masses obtained by \texttt{BASTA} reported in `Kages' and LEGACY, in order to maintain internal consistency with the age measurements. We note that age and mass posteriors from \texttt{BASTA} are correlated, but chose not to account for the unpublished correlations in this work.

As described in the catalogue papers, for `Kages' stars atmospheric properties (\teff and \feh) were measured through high-resolution spectroscopy \cite{huber+2013a}. For LEGACY stars, atmospheric properties were similarly taken from one study \cite{buchhave+latham2015} for most stars in the catalogue, and complemented by other values from the literature for the remaining stars \cite[see Table 3]{silvaaguirre+2017}.

Other asteroseismic properties used in this study, such as those used as first guesses on the free parameters in our asteroseismic model, were taken from the `Kages' and LEGACY catalogues \cite{astropycollaboration+2013, astropycollaboration+2018, ginsburg+2019}. In cases where both catalogues contained the same target, we used the stellar parameters reported in LEGACY \cite{mckinney2010}. This is also the case for the masses and ages described above.

\subsection{Mode Frequency Fitting}

In order to extract signatures of stellar rotation from the asteroseismic mode frequencies, we built a model that simultaneously treats the convective background, modes of oscillation, and white noise, while accounting for rotational splitting. The foundations of this approach follows best-practices in asteroseismology \cite{davies+2015}, fitting Harvey profiles for the background \cite{harvey1985} and expressing the frequencies of the modes using an asymptotic expression \cite{tassoul1980, vrard+2016}.

The first core improvement in this work is the use of hierarchical latent variable models \cite{hogg+2010, hall+2019}, which account for small-scale deviations in mode frequencies due to effects not explicitly accounted for in our model (such as acoustic glitches \cite{mazumdar+2014}). By improving the inference of mode frequencies in this way, we also improve the ability to resolve the rotational splitting. The second improvement comes in the form of priors on our parameters, and in particular the rotational inclination, which more accurately reflects the true distribution of angles than previous techniques \cite{chaplin+basu2017}. A step-by-step breakdown of the model and all priors can be found in \textbf{Supplementary Information}.\\

We separated our model fitting into two parts. First, we fit a model for the convective background and white noise only, to the region of the power spectra that did not contain modes of oscillation. This was done using \texttt{PyStan} \cite{vanhoey+2013, carpenter+2017}, for 10,000 iterations on each star. These \texttt{PyStan} runs were initiated with a random seed of 11, as were all other random processes in this work. Second, we fit our full model (including the convective background) to the region containing the modes of oscillation. The results of the first fit to the convective background were used as extremely informative priors on the background parameters in this second fit. This was done using \texttt{PyMC3} \cite{vanderwalt+2011, salvatier+2016, thetheanodevelopmentteam+2016} for 2500 iterations each on 4 chains.

From this asteroseismic analysis, we report inclination angle ($i$), rotational splitting ($\nu_{\rm s}$), and rotation period ($P$) in \textbf{Supplementary Information} Table 1. The summary statistics on these parameters were taken as the median of the posterior distribution, with uncertainties being the $15.9^{\rm th}$ and $84.1^{\rm st}$ percentiles. For inclination angle ($i = \arccos(\cos(i))$) and rotation ($P = 1/\nu_{\rm s}$), the full posterior samples were transformed before taking the summary statistics, as our model sampled in $\cos(i)$ and $\nu_{\rm s}$.

We flagged any sub-optimal conditions of the final fit. We flagged 5 for which the Gelman-Rubin convergence metric, $\hat{R}$, was greater than 1.01 and 2 stars for which it was greater than 1.1 on inclination angle or rotation, where a $\hat{R} = 1$ indicates a converged result \cite{gelman+rubin1992}. We also performed visual checks of the sampled chains on all hyperparameters and of the best-fit model compared to both the raw and smoothed asteroseismic data. We found no issues in the visual investigation of 94 stars. KIC 8478994 is not reported due to both a poor unconverged fit as well as high $\hat{R}$ on rotational parameters. KICs 6603624, 8760414 and 8938364 are reported in  \textbf{Supplementary Information} Table 1, but were excluded from the gyrochronology analysis due to strong disagreement with multiple studies in the literature (see main body of paper). Finally, we flagged any stars with fewer than 1000 effective samples ($n_{\rm eff}$) of $\nu_s$.

\subsection{Seismic vs Surface rotation}
As described in the main body of the paper, we compared a subsample of our asteroesismic rotation rates to surface rotation rates from spot rotation, where available. Both the surface ($P_{\rm surf}$) and seismic ($P_{\rm seis}$) rotation rates have associated uncertainties. Instead of fitting the slope between these two values directly, we instead fit the distribution

\begin{equation}
	p(\frac{P_{\rm seis}}{P_{\rm surf}}\, |\, m) = \mathcal{N}(m, \sigma_\frac{P_{\rm seis}}{P_{\rm surf}})\, ,
\end{equation}

\noindent where $m$ is the slope, and $\sigma_\frac{P_{\rm seis}}{P_{\rm surf}}$ is the uncertainty corresponding to $\frac{P_{\rm seis}}{P_{\rm surf}}$, following the propagation of the errors on both values. We used the larger of the asymmetrical uncertainties on asteroseismic rotation from our analysis. The model was fit using \texttt{PyMC3} for 2000 iterations each on 4 chains. Five stars for which both surface and seismic rotation were available, but which had a surface rotation above the 1.8:1 line, were excluded from this analysis. This was to exclude likely multiples of the true rotation rate skewing the fit, as measurements of double the true rotation may occur in spot rotation measurements.

Our fit found a value of $m = 0.96 \pm 0.03$ using 48 stars. We reran this analysis using the 21 stars in this sample for which the median of their posterior probability for $Q_{\rm WMB}$ was greater than $0.5$ in our stellar model analysis, preferring the WMB model. A fit to these stars alone found a value of $m = 0.96 \pm 0.04$.

\section{Gyrochronology Methods}\label{s:gyro}
\subsection{Stellar Models}\label{ssec:models}
The braking models used in this work have several parameters that inform the rotational evolution. These are: a normalization factor to reproduce the solar rotation ($f_k$); a disk locking timescale ($T_{\rm disk}$) and period ($P_{\rm disk}$) which together regulate the stellar angular velocity during the pre-main sequence; the critical angular velocity that marks the transition from saturated (rapidly rotating) to unsaturated (slowly rotating) regimes ($\omega_{\rm crit}$), and the critical Rossby number, above which stars conserve angular momentum ($Ro_{\rm crit}$), mentioned above. $T_{\rm disk}$, $P_{\rm disk}$ and $\omega_{\rm crit}$ are calibrated to match the behavior in young open clusters, but have little impact on the rotational evolution beyond $\approx 1\, \rm{Gyr}$ in solar-mass stars. Both $f_k$ and $Ro_{\rm crit}$ affect the late-time evolution. Both models adopt $\omega_{\rm crit} = 3.4  \times 10^{-5}\, \rm{s}^{-1}$, $P_{\rm disk} = 8.1$, $T_{\rm disk} = 0.28$ and $f_k = 6.6$. In the weakened magnetic braking model, $Ro_{\rm crit} = 1.97$. \rtwo{This Rossby number is based on model comparisons to catalogues of spot rotation rates \cite{vansaders+2019}. Its exact value is not critical in our analysis, as any similar value would create a model population significantly different from the standard case. In the model, the Rossby number is defined as the rotation period divided by the convective turnover timescale, which in turn is defined as $\tau_{\rm cz} = H_p / v_{\rm conv}$, where $H_p$ is the pressure scale height at the base of the convection zone, and $v_{\rm conv}$ is the convetive velocity evaluated one pressure scale height above the base in a mixing length theory of convection. Solid body rotation is assumed \cite{nielsen+2015}.} For further details, see \cite{vansaders+pinsonneault2013} and \cite{vansaders+2016, vansaders+2019} for the standard and weakened magnetic braking cases respectively.

To construct a synthetic population of rotating stars, we expanded upon previous forward-models of the \textit{Kepler} field with the purpose of studying weakened magnetic braking \cite{vansaders+2019}, with some important improvements. We started with a TRILEGAL \cite{girardi+2012} Milky-Way simulation of the \kepler field, using the simulation's standard population values intended for this purpose. In order to replicate the \kepler selection effect, the TRILEGAL simulation was matched to the largest current catalogue of temperatures, luminosities and 2MASS $K$-band magnitudes of stars in the \kepler field \cite{berger+2020}. This was done using a nearest-neighbours approach, based on the density of stars on the HR diagram. This ensured that the TRILEGAL population matched the density of stars actually observed by \kepler, replicating its selection effects, and improved upon previous efforts \cite{vansaders+2019} by incorporating contemporary \textit{Gaia} mission data \cite{gaiacollaboration+2018}.

We made further changes to account for possible binarity in the the matching sample \cite{berger+2020}. If the first step is performed blindly, blended binaries in the sample cause an overestimation of the number of old stars. In order to overcome this, we:

\begin{enumerate}
	\item blended the TRILEGAL stars with binary companions drawn from a flat mass-ratio distribution, using a known binary fraction \cite{raghavan+2010},
	\item recalculated the `observed' luminosities and magnitudes assuming that each binary pair was blended, and
	\item shifted these stars' temperatures following a $g$-$K$ magnitude relation \cite{berger+2020}.
\end{enumerate}

This new distribution was used for the nearest-neighbour matching. Once drawn we dropped the binary companion and used the true TRILEGAL properties of those stars. For stars where the mass of the companion was $M < 0.4\, \odot$, binary contributions were ignored. Every binary was assumed to result in a blend, regardless of separation. This results in slightly more young stars than reality, because young, blended binary systems contaminate regions of the HR diagram where one expects to find old stars, and the number of blends is overestimated by assuming every binary system is a blend.

Our asteroseismic sample of stars with short cadence observations are subject to additional selection functions not included in the creation of the model populations above. We did \textit{not} explicitly account for these asteroseismic selection functions in our model, by design. Both the standard and WMB models contain stars with the same fundamental parameters (mass, radius, effective temperature, metallicity) but a different period based on the choice of rotational evolution prescription. Applying an asteroseismic selection function that depends on these fundamental parameters would have an identical effect on both models, therefore providing no net effect on our posterior distribution \cite{chaplin+2011}.  Additionally, we expected any seismic selection function to be relatively flat (and therefore uninformative) on a star-by-star scale, on which we run our model analysis. 

\subsection{Bayesian Mixture Model}
In order to determine whether weakened magnetic braking occurs on the main sequence, we compared our sample of seismic age and rotation, along with temperature, metallicity and mass, to the two stellar population models of the \kepler field \cite{vansaders+2019}, discussed above. Both stellar models were evaluated in a Bayesian framework, with the rationale of determining which of the two models (standard or WMB) is most likely to reproduce our observed data. Each model sample contained temperature (\teff), mass ($M$), age ($t$), metallicity ($\rm{[Fe/H]}$) and rotation ($P$) information.

In order to draw probabilistic inference about the models, we built a five-dimensional Kernel Density Estimate (KDE) of both model populations using the \texttt{statsmodels} package \cite{seabold+perktold2010}. We used a band-width (setting the resolution of the KDE) of $0.02\, \odot$ in mass, $10\, \rm K$ in \teff, $0.01\, \rm{dex}$ in $\ln(t)$, $0.01\, \rm{dex}$ in $\rm{[Fe/H]}$ and $0.01\, \rm{dex}$ in $\ln(P)$. Note that age and rotation were treated in log space, where the posterior estimates from asteroseismology more closely resemble normal distributions. This approach translates the population models to a probability distribution we can use in a Bayesian framework.

We evaluated our data against both models simultaneously by treating the data as being drawn from a mixture of both model KDEs. In this mixture model structure, the two KDEs were modulated by a weighting factor, $Q_{\rm WMB}$. In the limit $Q_{\rm WMB} \rightarrow 1$, the data are most likely drawn from the WMB model. In the limit $Q_{\rm WMB} \rightarrow 0$, the data are most likely drawn from the standard model.

The posterior probability of obtaining $Q_{\rm WMB}$ and additional parameters $\theta$ given our data $\mathcal{D}$ is $p(Q_{\rm{WMB}}, \theta | \mathcal{D})$. Using Bayes equation, we can express this as:

\begin{equation}\label{eq:modelll}
	p(Q_{\rm{WMB}}, \theta | \mathcal{D}) \propto p(\mathcal{D} | \theta)\ p(\theta | Q_{\rm{WMB}}, \kappa_{\rm{s}}, \kappa_{\rm{WMB}})\ p(Q_{\rm{WMB}})\, ,
\end{equation}

\noindent where $\kappa_{\rm{s}}$ and $\kappa_{\rm{WMB}}$ are the KDE functions for the standard and WMB models respectively, and $\theta$ here are parameters, $\theta = \{M, \teff, \ln(t), \feh, \ln(P)\}$. The parameters $\theta$ may be referred to as latent parameters, as they form a step between the parameter we want to infer ($Q_{\rm{WMB}}$) and our data. Using this approach allowed our model to properly take into account the observational uncertainties on the data \rtwo{in five dimensions.}

The second component on the right hand side of Equation \ref{eq:modelll} describes the probability of obtaining our latent parameters $\theta$ given our KDEs and the mixture model weighting parameter $Q_{\rm WMB}$, and is described by the mixture model

\begin{equation}\label{eq:mixturell}
	p(\theta | Q_{\rm{WMB}}, \kappa_{\rm{WMB}}, \kappa_{\rm{s}}) = Q_{\rm WMB} \times \kappa_{\rm WMB}(\theta) + (1 - Q_{\rm WMB}) \times \kappa_{\rm s}(\theta)\, ,
\end{equation}

\noindent where all parameters are as described above. This probability function describes a distribution that is a mixture of both KDEs. While the KDEs are constant, $Q_{\rm WMB}$ is a free parameter, and so the shape of this distribution can vary. The latent parameters $\theta$ are drawn from this distribution, and therefore from some combination of the two stellar models.

The first component in Equation \ref{eq:modelll} describes the likelihood of obtaining the parameters $\theta$ given our data and their observational uncertainty. It takes the form

\begin{equation}
	p(\mathcal{D} | \theta) = \mathcal{N}(\mathcal{D} | \theta, \sigma_{\mathcal{D}})\, ,
\end{equation}

\noindent a normal distribution evaluating the latent parameters $\theta$ against the observations, with observational uncertainty $\sigma_{\mathcal{D}}$. This approach means that in each parameter space (such as age), the age drawn from the stellar model mixture is entered into the likelihood equation with our static observations. The value of this equation (and thus the likelihood) will increase if $\theta$ is closer to the observations, and the mixture model will be modulated in a manner that maximises this probability, inferring whether one stellar model is more likely to produce our data than the other.

The final term, $p(Q_{\rm WMB})$, represents the prior on the mixture model weight, which is uniform between 0 and 1. A visual representation of our model is shown in \textbf{Extended Data} Figure \ref{fig:pgm}.

Typically, this model would evaluate all stars in our sample against the stellar models simultaneously for a single posterior estimate of $Q_{\rm WMB}$. At 95 stars, in 5 parameter spaces, this totals 476 free parameters to marginalise over. This is not an issue for Hamiltonian Monte Carlo \cite[HMC]{betancourt+girolami2013}, however the use of KDE functions, over which a probabilistic gradient can not be measured, reduces HMCs effectiveness. Alternative Markov Chain Monte Carlo techniques \cite[MCMC]{foreman-mackey+2013} can more efficiently sample the KDE functions, but can not treat the large number of hierarchical parameters. To overcome this, we fit our model to each star to obtain an independent individual posterior distribution for $Q_{\rm WMB}$, and multiplied these post hoc to obtain a combined posterior. This comes with the benefit of easily allowing us to calculate the combined posterior for different stellar classifications, at the expense of the ability to marginalise for a single value of $Q_{\rm WMB}$ directly.\\

The parameter space of the stellar model populations were reduced before calculating the KDEs. These cuts were made in $M$, $\teff$, $\ln(t)$ and \feh, removing any stars in the models that fell more than $3 \times \sigma_{\mathcal{D}}$ outside the observations. Our observables $M$, $t$ and $P$ have asymmetric uncertainties from the Bayesian asteroseismic analysis. We used the larger of the reported uncertainties on each parameter as $\sigma_{\mathcal{D}}$ in each parameter space. 

KIC 6278762 was excluded from this stellar model analysis, because its age fell more than $3\sigma$ outside of the highest age in the stellar models (this is a metallicity issue, as the oldest stars have metallicities outside the range of the rotational model grids), and KICs 7106245 and 8760414 were excluded for the same reason due to low metallicities outside the functional range of the stellar models (-0.99 and -0.92 respectively). We also excluded any stars with $n_{\rm eff} < 1000$ for rotational splitting, and those with $\hat{R} > 1.1$. The remaining sample of 73 stars contained 4 sub-giants, 22 `hot' stars, and 47 main sequence stars.

We fit our model Equation \ref{eq:modelll} using \texttt{emcee} \cite{foreman-mackey+2013, foreman-mackey2016}, using 32 walkers for a total of 7500 samples per walker, of which the first 2500 were discarded as a burn-in.

After fitting, we took a normalised histogram of the posterior estimate of $Q_{\rm WMB}$ for each star, using 100 bins. In this histogram, each bin approximated the value of the posterior function for $Q_{\rm WMB}$. The array of 100 bins for all stars were multiplied, resulting in an approximation of the joint posterior probability function for $Q_{\rm WMB}$ given all stars in the ensemble.\\



\textbf{Data availability statement:} The core input data and results are summarised in  \textbf{Supplementary Information} Table 1, which is published with this article, and is also available on Vizier. Larger data files, such as stellar model populations and individual posterior distribution chains from the asteroseismic and gyrochronology model fitting are fully available on request.

This work made use of publicly available data. \kepler power spectral densities were obtained from the \href{http://kasoc.phys.au.dk/}{KASOC} webpages for the majority of stars, and from the \href{https://archive.
		stsci.edu/prepds/kepseismic/}{MAST} for 16 Cyg A and B. This work used asteroseismic data from Silva Aguirre et al. (2015, 2017), Davies et al. (2016) and Lund et al. (2017) \cite{silvaaguirre+2015, silvaaguirre+2017, davies+2016, lund+2017}. Parameter distributions of the \kepler field used to alter our stellar population models were taken from Berger et al. (2020) \cite{berger+2020}.\\
	
\textbf{Code availability statement:} The code required to replicate our results has been placed in a curated online repository found here: \url{www.github.com/ojhall94/halletal2021}. 

All code written in the duration of this project, along with a full commit history, can be found in an un-curated online repository here: \url{www.github.com/ojhall94/malatium}. 

The code used to construct the stellar population models used in this work is available upon request.

\input{bblmethods.tex}
%\bibliographystyle{naturemag}
%\bibliography{library.bib} % if your bibtex file is called example.bib
%
%\end{document}